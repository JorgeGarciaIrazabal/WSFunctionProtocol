<!DOCTYPE html>
<html>
<head>
    <title>tornado WebSocket example</title>
    <!--File auto-generated by the server
    Path needs to match with Hub.constructJSFile paths parameter-->
    <script type="text/javascript" src="_static/WSProtocol.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.4.2.js"></script>
</head>
<body>
<div class="container">
    <h1>tornado WebSocket example with WSHubsAPI</h1>
    <hr>
    WebSocket status : <span id="status">Waiting connection</span><br>
    Name: <input type="text" id="name" value="Kevin"/><br>
    <input type="text" id="message" />
    <input type="button" id="sendmessage" value="Send" />
    <input type="hidden" id="displayname" />
    <ul id="discussion">
    </ul>
</div>
    <script>
    function sendToAll(){
        $ws.server.ChatHub.sendToAll($('#name').val(),$('#message').val());
        $('#message').val('').focus();
    }
    $ws = $wsConnectionInit('ws://127.0.0.1:8888/')

    $ws.onopen = function(){
        $('#status').text("Connected")
        $ws.client.ChatHub.onMessage = function(from, message){
            $('#discussion').append('<li><strong>' + from
                    + '</strong>: ' + message + '</li>');
        }
        $('#sendmessage').click(sendToAll);
        $('#message').keypress(function(e){
            if (e.which == 13)
                sendToAll()
        });
    };

    $ws.onclose = function(ev){
        $('#status').text("Closed")
    };
    $ws.onerror = function(ev){
        alert(ev)
    };
</script>
</body>
</html>
